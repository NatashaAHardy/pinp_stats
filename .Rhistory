axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top") +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
scale_colour_manual(values=figS3.pal, name="Haplotype:")+
scale_size(range = c(12, 32),
guide=FALSE) +
guides(colour = guide_legend(override.aes = list(size=10)))+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_bubble
ggsave(here('./figures/figS3_haplo_bubble.pdf'), plot = figS3_haplo_bubble, width = 10, height = 10, dpi = 300)
#checking that my setup chunk works, it's been a PIA lately, may need to update to latest versions of R and RStudio...lame
#getwd()
# Packages
#install.packages("rcompanion")
#install.packages("gg.gap")
#Load
library(tidyverse)
library(tidyr)
library(tidytext)
#library(reshape)
library(plyr)
library(dplyr)
library(PNWColors)
library(lattice)
library(reshape2)
library(lme4)
library(ggplot2)
library(rcompanion)
library(gg.gap)
library(forcats)
library(devtools)
library(cowplot)
library(grid)
library(gridExtra)
library(scales)
library(ggpubr)
library(here)
"%notin%" = Negate('%in%')
here::here()
#Note that loading all these packages is hell because of overlap in functions, some packages being superceded but still requiring each other or requiring functions from one package to another. You'll notice I had to force a lot of functions by calling the package as follows
#data %>% package::function(etc)
# Bird detections data from four export pivot table tabs as .csv
#https://docs.google.com/spreadsheets/d/1D6EqzmLSjwK2ENXtqOLQHwNu65CnmqUDlcJg-lPaZMI/edit#gid=1310896506
#Sometimes Rmd plays up with the setup chunk and you may need to force entry to the data using:
#read.csv("/Users/natasha/Documents/Professional/WORK/CURRENT JOBS/PINP/PINP DATA/pinp_stats/data/bird_detection.csv", header=TRUE)
#1 = "bird_detect_med" tab
bird_wide_med <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/bird_detect_med.csv", header=TRUE)
str(bird_wide_med)
#2 = "bird_detect_high" tab
bird_wide_high <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/bird_detect_high.csv", header=TRUE)
#3 = "penguin_detect_med" tab
penguin_wide_med <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/penguin_detect_med.csv", header=TRUE)
#4 = "penguin_detect_high" tab
penguin_wide_high <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/penguin_detect_high.csv", header=TRUE)
#5 = "otu_med" tab
otu_med_export <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/otu_med.csv", header=TRUE)
#6 = "otu_high" tab
otu_high_export <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/otu_high.csv", header=TRUE)
#0 = "hp_taxa" tab
hp_taxa_export <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/hp_taxa.csv", header=TRUE)
str(hp_taxa_export)
#7 penguin haplotypes
penguin_haplos_export <- read.csv("/Users/natasha/Documents/Professional/WORK/PINP/PINP DATA/pinp_stats/data/penguin_haplos.csv", header=TRUE)
str(penguin_haplos_export)
figS3_haplo_presence = penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
View(otu_med)
View(otu_rra)
View(penguin_haplos)
figS3_haplo_presence = penguin_haplos %>%
separate(sample_id, c("loc", "month", "year", "sample")) %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
#### OTU_med ----
penguin_haplos = penguin_haplos_export %>%
dplyr::select(-time) %>%
dplyr::rename(haplo_1 = `SUM.of.haplo_1`,
haplo_2 = `SUM.of.haplo_2`,
haplo_3 = `SUM.of.haplo_3`,
haplo_4 = `SUM.of.haplo_4`,
haplo_5 = `SUM.of.haplo_5`,
haplo_6 = `SUM.of.haplo_6`,
haplo_7 = `SUM.of.haplo_7`) %>%
#Renamed columns
reshape2::melt(id.vars=c("sample_id", "location_id", "location", "time_id", "group_id"), variable.name = "haplotype", value.name = "seq_abun") %>%
mutate(seq_presence = if_else(seq_abun > 0, "1", "0")) %>%
filter(seq_abun > 1) %>%
separate(sample_id, c("loc", "month", "year", "sample"))
str(penguin_haplos)
figS3_haplo_presence = penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample, y=seq_presence, fill=haplotype)) +
coord_flip()
figS3_haplo_presence
View(penguin_haplos)
figS3_haplo_presence = penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
figS3_haplo_presence = penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
figS3_haplo_presence = penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
figS1_otu_RRA = otu_rra %>%
ggplot() +
geom_bar(aes(x=time_id:sample, y=prop_abun, fill=OTU), stat="identity")+
coord_flip()+
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.y = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text=element_text(size=18),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=fig4b.pal, name="Taxa:")+
labs(x="Sample date: sample number", y="Relative DNA abundance (%)") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS1_otu_RRA
figS3_haplo_bubble = penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=x=time_id:sample, y=seq_presence, fill=haplotype, colour=haplotype, size=seq_abun)) + #,
geom_point(position="stack") +
geom_text(aes(label=seq_abun, #rev(seq_abun) this appeared to completely reorder the seq data all over the graph
#vjust=0.5,
#hjust=2
),
#colour="#333333",
colour="white",
size=6,
position = position_stack(vjust = 1)) +
coord_flip() +
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top") +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
scale_colour_manual(values=figS3.pal, name="Haplotype:")+
scale_size(range = c(12, 32),
guide=FALSE) +
guides(colour = guide_legend(override.aes = list(size=10)))+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_bubble
View(penguin_haplos)
figS3_haplo_bubble = penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample_id, y=seq_presence, fill=haplotype, colour=haplotype, size=seq_abun)) + #,
geom_point(position="stack") +
geom_text(aes(label=seq_abun, #rev(seq_abun) this appeared to completely reorder the seq data all over the graph
#vjust=0.5,
#hjust=2
),
#colour="#333333",
colour="white",
size=6,
position = position_stack(vjust = 1)) +
coord_flip() +
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top") +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
scale_colour_manual(values=figS3.pal, name="Haplotype:")+
scale_size(range = c(12, 32),
guide=FALSE) +
guides(colour = guide_legend(override.aes = list(size=10)))+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_bubble
#### OTU_med ----
penguin_haplos = penguin_haplos_export %>%
dplyr::select(-time) %>%
dplyr::rename(haplo_1 = `SUM.of.haplo_1`,
haplo_2 = `SUM.of.haplo_2`,
haplo_3 = `SUM.of.haplo_3`,
haplo_4 = `SUM.of.haplo_4`,
haplo_5 = `SUM.of.haplo_5`,
haplo_6 = `SUM.of.haplo_6`,
haplo_7 = `SUM.of.haplo_7`) %>%
#Renamed columns
reshape2::melt(id.vars=c("sample_id", "location_id", "location", "time_id", "group_id"), variable.name = "haplotype", value.name = "seq_abun") %>%
mutate(seq_presence = if_else(seq_abun > 0, "1", "0")) %>%
filter(seq_abun > 1) #%>%
View(penguin_haplos)
#### OTU_med ----
penguin_haplos = penguin_haplos_export %>%
dplyr::select(-time) %>%
dplyr::rename(haplo_1 = `SUM.of.haplo_1`,
haplo_2 = `SUM.of.haplo_2`,
haplo_3 = `SUM.of.haplo_3`,
haplo_4 = `SUM.of.haplo_4`,
haplo_5 = `SUM.of.haplo_5`,
haplo_6 = `SUM.of.haplo_6`,
haplo_7 = `SUM.of.haplo_7`) %>%
#Renamed columns
reshape2::melt(id.vars=c("sample_id", "location_id", "location", "time_id", "group_id"), variable.name = "haplotype", value.name = "seq_abun") %>%
mutate(seq_presence = if_else(seq_abun > 0, "1", "0")) %>%
filter(seq_abun > 1) %>%
mutate(separate(sample_id, c("loc", "month", "year", "sample")))
#### OTU_med ----
penguin_haplos = penguin_haplos_export %>%
dplyr::select(-time) %>%
dplyr::rename(haplo_1 = `SUM.of.haplo_1`,
haplo_2 = `SUM.of.haplo_2`,
haplo_3 = `SUM.of.haplo_3`,
haplo_4 = `SUM.of.haplo_4`,
haplo_5 = `SUM.of.haplo_5`,
haplo_6 = `SUM.of.haplo_6`,
haplo_7 = `SUM.of.haplo_7`) %>%
#Renamed columns
reshape2::melt(id.vars=c("sample_id", "location_id", "location", "time_id", "group_id"), variable.name = "haplotype", value.name = "seq_abun") %>%
mutate(seq_presence = if_else(seq_abun > 0, "1", "0")) %>%
filter(seq_abun > 1)
penguin_haplos_sample = penguin_haplos %>%
separate(sample_id, c("loc", "month", "year", "sample"))
figS3_haplo_presence = penguin_haplos_sample %>%
#penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
View(penguin_haplos_sample)
figS3_haplo_presence = penguin_haplos_sample %>%
#penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:year, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
figS3_haplo_presence = penguin_haplos_sample %>%
#penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:time_id, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
penguin_haplos_sample$sample <- as.factor(penguin_haplos_sample$sample)
figS3_haplo_presence = penguin_haplos_sample %>%
#penguin_haplos %>%
filter(seq_abun > 1) %>%
ggplot(aes(x=time_id:sample, y=seq_presence, fill=haplotype)) +
coord_flip()+
geom_bar(stat="identity")+
geom_text(aes(label=seq_abun,
#vjust=0,
#hjust=2
),
colour="white",
size=6,
position = position_stack(vjust = 0.5)) + #xlab("")
theme_classic() +
theme(panel.grid.major = element_blank(),
axis.ticks.x = element_blank(),
plot.title=element_text(face="bold", size=18),
axis.title=element_text(size=18),
axis.text.y =element_text(size=18),
axis.text.x =element_blank(),
legend.text=element_text(size=16),
legend.title=element_text(size=16),
legend.position="top"
) +
scale_fill_manual(values=figS3.pal, name="Haplotype:")+
labs(x="Sample date: sample number", y="Little penguin haplotypes & sequence abundance") + # Axis labels
facet_grid(location~., scales="free", space='free') +
theme(strip.text = element_text(size=rel(1.5)), #face="bold",
strip.background = element_rect(fill="lightgrey", colour="black",
size=1))
figS3_haplo_presence
ggsave(here('./figures/figS3_haplo_presence.pdf'), plot = figS3_haplo_presence, width = 10, height = 10, dpi = 300)
ggsave(here('./figures/figS3_haplo_presence.jpg'), plot = figS3_haplo_presence, width = 10, height = 10, dpi = 300)
